질문 (원본):
2025-10-29

질문: @# Planner - 계획자 (Project Planner) 너가 사용할 PRD를 만들자.

- 1. 반복 유형 선택
  - [ ] 일정 생성 또는 수정 시 반복 유형을 선택할 수 있다.
  - [ ] 반복 유형은 다음과 같다: 매일, 매주, 매월, 매년
    - [ ] 31일에 매월을 선택한다면 → 매월 마지막이 아닌, 31일에만 생성하세요.
    - [ ] 윤년 29일에 매년을 선택한다면 → 29일에만 생성하세요!
  - [ ] 반복일정은 일정 겹침을 고려하지 않는다.

2. 반복 일정 표시
   - [ ] 캘린더 뷰에서 반복 일정을 아이콘을 넣어 구분하여 표시한다.
3. 반복 종료
   - [ ] 반복 종료 조건을 지정할 수 있다.
   - [ ] 옵션: 특정 날짜까지
     - 예제 특성상, 2025-12-31까지 최대 일자를 만들어 주세요.
4. **반복 일정 수정**
   1. [ ] '해당 일정만 수정하시겠어요?' 라는 텍스트에서 '예'라고 누르는 경우 단일 수정
      - [ ] 반복일정을 수정하면 단일 일정으로 변경됩니다.
      - [ ] 반복일정 아이콘도 사라집니다.
   2. [ ] '해당 일정만 수정하시겠어요?' 라는 텍스트에서 '아니오'라고 누르는 경우 전체 수정
      - [ ] 이 경우 반복 일정은 유지됩니다.
      - [ ] 반복일정 아이콘도 유지됩니다.
5. **반복 일정 삭제**
   1. [ ] '해당 일정만 삭제하시겠어요?' 라는 텍스트에서 '예'라고 누르는 경우 단일 수정
      1. [ ] 해당 일정만 삭제합니다.
   2. [ ] '해당 일정만 삭제하시겠어요?' 라는 텍스트에서 '아니오'라고 누르는 경우 전체 수정
      1. [ ] 반복 일정의 모든 일정을 삭제할 수 있다.

나는 이런것을 할거야 곧. histor의 파일들을 보고 너가 작성해봐.

 ---------
 '해당 일정만 수정하시겠어요?' 라는 텍스트에서 '아니오'라고 누르는 경우 전체 수정
내가 이것만 작성을 해서 너에게 줬을때
너가 이 문장을 파악하고 실행으로 옮길 수 있도록 prd를 작성해봐.
이prd는 agents/prd.md에 작성해라.
prd에 꼭 들어가야하는것은 input output이 비교가 되어야하고 체크리스트가 있어야하고 작업을 할때 어떤 문서를 참고할껀지도 있어야한다. 이슈가 생겼을때는 어떻게 할껀지 도 들어 있어야해.

답변:

# PRD (Product Requirement Document) 템플릿 생성 완료!

Planner가 사용할 표준화된 PRD 템플릿과 구체적인 예시를 `src/.cursor/agents/prd.md`에 작성했습니다.

---

## 🎯 PRD 구조

### 1️⃣ **PRD Template Structure** (템플릿 구조)

PRD는 다음 8개 섹션으로 구성됩니다:

1. **Feature Overview** (기능 개요)
   - What, Why, User Story

2. **Input → Output Specification** ⭐ (입력 → 출력 명세)
   - Input (사용자 입력)
   - Process (처리 과정)
   - Output (예상 결과)
   - Example (구체적 예시: Before → Action → After)

3. **Technical Requirements** (기술 요구사항)
   - Data Model (TypeScript types)
   - API Changes
   - UI Components

4. **Implementation Checklist** ⭐ (구현 체크리스트)
   - Phase 1: Planning (Planner)
   - Phase 2: Test (Test Team via Worker)
   - Phase 3: Implementation (Feature Team via Worker)
   - Phase 4: Integration (Worker)
   - Phase 5: Quality (Manager)

5. **Reference Documents** ⭐ (참고 문서)
   - Memory Home (과거 패턴)
   - Worker Home (코드 컨벤션)
   - Test Team (테스트 가이드)
   - Feature Team (구현 가이드)
   - .cursorrules (프로젝트 규칙)
   - TDD Guide (TDD 방법론)

6. **Edge Cases & Constraints** (엣지 케이스 & 제약사항)
   - 처리할 엣지 케이스 목록
   - 성능, 데이터 무결성, UI/UX 제약

7. **Issue Handling Protocol** ⭐ (이슈 처리 프로토콜)
   - During Planning (계획 중)
   - During Implementation (구현 중)
   - During Review (검토 중)
   - Critical Blockers (치명적 장애물 → King 에스컬레이션)

8. **Success Criteria** (성공 기준)
   - Functional Requirements
   - Non-Functional Requirements
   - Quality Requirements
   - Documentation Requirements

---

## 📝 구체적인 예시: "반복 일정 일괄 수정"

사용자가 요청한 **"'해당 일정만 수정하시겠어요?' → '아니오' 클릭 → 전체 수정"** 시나리오를 완전한 PRD로 작성했습니다.

### Input → Output 명세 (핵심!)

```markdown
## Before (변경 전):
캘린더에 매주 월요일 10:00-11:00 "팀 스탠드업" 반복 일정이 표시됨
- 2024-11-04 (월) 10:00-11:00 팀 스탠드업 🔁
- 2024-11-11 (월) 10:00-11:00 팀 스탠드업 🔁
- 2024-11-18 (월) 10:00-11:00 팀 스탠드업 🔁
- ... (continues until 2025-12-31)

## User Action (사용자 행동):
1. 사용자가 2024-11-11의 "팀 스탠드업"을 클릭
2. "수정" 버튼 클릭
3. 모달 표시: "해당 일정만 수정하시겠어요?"
4. 사용자가 "아니오" 버튼 클릭 (전체 수정 모드)
5. 시간을 10:00-11:00 → 09:30-10:30으로 변경
6. 제목을 "팀 스탠드업" → "팀 데일리 미팅"으로 변경
7. "저장" 버튼 클릭

## After (변경 후):
캘린더의 모든 인스턴스가 업데이트됨
- 2024-11-04 (월) 09:30-10:30 팀 데일리 미팅 🔁  ✅
- 2024-11-11 (월) 09:30-10:30 팀 데일리 미팅 🔁  ✅
- 2024-11-18 (월) 09:30-10:30 팀 데일리 미팅 🔁  ✅
- ... (모든 미래 인스턴스도 동일하게 변경됨)

알림 표시: "일정이 수정되었습니다."
반복 아이콘 🔁 유지됨
```

### 데이터 변화 (Before/After 코드 포함)

```typescript
// Before
events: [
  {
    id: "recurring-1-2024-11-01",
    title: "주간 회의",
    startTime: "10:00",
    endTime: "11:00",
    repeat: { type: "weekly", interval: 1 },
    originalId: "recurring-1"
  },
  // ... more instances
]

// After (user changed time to 14:00-15:00)
events: [
  {
    id: "recurring-1-2024-11-01",
    title: "주간 회의",
    startTime: "14:00",  // ✅ Changed
    endTime: "15:00",    // ✅ Changed
    repeat: { type: "weekly", interval: 1 },  // ✅ Maintained
    originalId: "recurring-1"  // ✅ Preserved
  },
  // ... all instances updated
]
```

---

## 🔍 구현 체크리스트 (5단계)

### Phase 1: Planning (Planner)
- [ ] Review Memory for similar bulk operations
- [ ] Break down into TDD cycles (Cycle 1~4)
- [ ] Identify test cases (normal, edge, error)

### Phase 2: Test (Test Team via Worker)
- [ ] Unit Test: `updateRecurringEventInstances.spec.ts`
- [ ] Integration Test: `useEventOperations.spec.ts` (extend)
- [ ] Component Test: Modal "아니오" button interaction
- [ ] Verify Red phase (tests failing)

### Phase 3: Implementation (Feature Team via Worker)
- [ ] Create Utility: `updateRecurringEventInstances()`
- [ ] Update Hook: `useEventOperations` with `editMode`
- [ ] Update UI: Modal with "예"/"아니오" buttons
- [ ] Verify Green phase (tests passing)

### Phase 4: Integration (Worker)
- [ ] Integrate utility → hook → UI
- [ ] Test end-to-end flow
- [ ] Refactor if needed (keep tests green)

### Phase 5: Quality (Manager)
- [ ] Code review
- [ ] Verify naming conventions
- [ ] Check test coverage > 80%
- [ ] Validate against PRD

---

## 📚 참고 문서 (세부 지침)

각 단계에서 참고해야 할 구체적인 문서와 섹션:

### Code Patterns
- **Memory Home** (`memoryHome.md`)
  - Section: "Recurring Events Implementation" (lines 400-800)
  - Pattern: How to generate recurring event instances
  - Bug Fix: Avoid creating duplicates (see history 1028_16)

### Testing
- **Test Team** (`company/test-team.md`)
  - Unit Test: AAA pattern
  - Integration Test: `renderHook()` + `act()`
  - Component Test: `render()` + `fireEvent()`

### Implementation
- **Feature Team** (`company/feature-team.md`)
  - Function Creation: 6-step process
  - Naming: camelCase + intuitive Korean

### Rules
- **.cursorrules**
  - TypeScript mandatory
  - Function naming conventions

---

## 🚨 이슈 처리 프로토콜 (구체적인 시나리오)

### Scenario 1: 계획 중 - 요구사항 불명확

**Issue**: "Bulk edit should affect singularized instances?"
<!-- 일괄 수정이 단일 일정으로 변환된 인스턴스에도 영향을 주어야 하는가? -->

**Resolution**:
1. Planner checks Memory for past decisions
2. No precedent → Escalate to King with options:
   - Option A: Affect all instances (including singularized)
   - Option B: Only affect recurring instances
3. King decides: Option B
4. Planner updates PRD
5. Planner informs Worker

---

### Scenario 2: 구현 중 - 테스트 실패

**Issue**: "Bulk edit removes repeat field"
<!-- 일괄 수정이 repeat 필드를 제거함 -->

**Resolution**:
1. Worker reviews test with Test Team → Test is correct
2. Worker reviews implementation with Feature Team
3. Feature Team finds bug:
```typescript
// ❌ Bug
return { ...instance, ...updates };  // overwrites repeat!

// ✅ Fix
return { 
  ...instance, 
  ...updates, 
  repeat: instance.repeat  // preserve explicitly
};
```
4. Worker fixes, tests pass
5. Document in `memoryHome.md`: "Object spread can overwrite nested fields"

---

### Scenario 3: 검토 중 - 품질 기준 미충족

**Issue**: "Function name not intuitive in Korean"
<!-- 함수 이름이 한국어로 직관적이지 않음 -->

**Resolution**:
1. Manager: `bulkUpdateEvents` → "bulk update events"는 어색
2. Manager provides feedback to Worker
3. Worker delegates to Feature Team
4. Feature Team suggests: `updateRecurringEventInstances` → "반복 일정 인스턴스를 업데이트한다" ✅
5. Worker refactors (rename + update usages)
6. Tests still pass
7. Manager approves

---

### Scenario 4: 치명적 장애물 - King 에스컬레이션

**Issue**: "1000+ instances take 5+ seconds (too slow)"

**Escalation Path**: Worker → Planner → King

**King Decisions**:
- Option A: Proceed with limitation (warn if > 100 instances)
- Option B: Delay feature for backend optimization
- Option C: Implement client-side pagination

---

## ✅ 성공 기준

### Functional (기능)
- [ ] "아니오" 클릭 → 모든 인스턴스 업데이트
- [ ] 반복 아이콘 🔁 유지
- [ ] `repeat` 필드 보존
- [ ] `originalId` 유지

### Quality (품질)
- [ ] Test coverage > 80%
- [ ] Function names intuitive in Korean
- [ ] No `any` types
- [ ] JSDoc comments

### Documentation (문서)
- [ ] Code comments explain "why"
- [ ] Edge cases documented
- [ ] Patterns added to `memoryHome.md`

---

## 🎓 PRD의 가치

이 PRD 템플릿을 사용하면:

1. **King**: 한 문장 ("아니오 클릭 시 전체 수정")만 주면 됨
2. **Planner**: PRD를 채워서 상세 계획 생성
3. **Worker**: PRD를 보고 정확히 무엇을 만들어야 하는지 이해
4. **Test Team**: Input → Output을 보고 테스트 케이스 작성
5. **Feature Team**: 체크리스트를 따라 구현
6. **Manager**: PRD 대비 검증

**결과**: 모호함 없이, 체계적으로, 검증 가능하게 기능 개발! 🎉

---

## 📂 파일 위치

**생성된 파일**: `src/.cursor/agents/prd.md`

**구조**:
- Part 1: PRD Template (how to write PRD)
- Part 2: Concrete Example (반복 일정 일괄 수정)
- Part 3: Issue Handling with real scenarios

이제 King이 간단한 요구사항만 주면, Planner가 이 템플릿을 사용하여 완전한 PRD를 작성하고, 전체 팀이 같은 이해를 바탕으로 작업할 수 있습니다! 🚀

