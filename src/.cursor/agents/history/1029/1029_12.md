질문 (원본):
2025-10-29

질문: 계획자를 리팩토링하자. 계획자는 계획을 할때 doc/checklist와 tdd 문서를 참고하고 있는지 확인이되어야하고. 해당 문서를 참고 안했을때와 비교해서 결과값이 다른지도 비교해야한다. 왜냐하면 문서를 참고 안해도 결과값이 같다면 굳이 doc의 문서들을 읽을 필요가 없으니깐. 계획자가 계획을 세우면 prd.md를 활용해서 request폴더안에 제품 요구사항 정의서를 파일을 만들어서 저장을 할수 있도록 리팩토링해줘.
계획자집도 확인해서 중복되는 내용이 있으면 삭제하고 리팩토링해줘.

답변:

# 계획자(Planner) 리팩토링 완료 ✅

## 📊 변경 전후 비교

### planer.md
- **Before**: 123줄, 10개 섹션
- **After**: 208줄, 9개 섹션
- **변화**: +85줄 (상세한 프로세스 추가)

### planerHome.md
- **Before**: 180줄
- **After**: 148줄
- **변화**: -32줄 (중복 제거)

---

## 🔍 발견된 문제점

### planer.md 문제점

1. **중복**: Role Definition ↔ description (같은 내용 반복)

2. **누락 - 문서 참조 프로세스 없음**:
   - ❌ `doc/tdd.md` 참조 없음
   - ❌ `doc/checklist.md` 참조 없음
   - ❌ `.cursorrules` 참조 없음

3. **누락 - PRD 템플릿 프로세스 없음**:
   - ❌ `prd.md` 템플릿을 사용하는 방법 없음
   - ❌ `request/` 폴더에 문서 생성하는 프로세스 없음

4. **프로젝트 특정 내용**:
   - ❌ "Recurring Events Specific Planning" (이 프로젝트에만 해당)

5. **워크플로우 불명확**:
   - 단계별 구분 없이 나열만 됨

### planerHome.md 문제점

1. **중복**: "Workflow Execution Steps" ↔ planer.md의 "Workflow Process"

2. **목적 불명확**: 
   - 학습 저장소인지, 워크플로 정의인지 불명확
   - 프로젝트 특정 내용과 일반 패턴이 섞여있음

3. **중복**: "Integration with Memory" (planer.md에 더 상세히 있음)

4. **중복**: "Workflow Templates" (너무 일반적)

---

## 🔧 적용한 리팩토링

### 1. planer.md 리팩토링

#### A. description 업데이트
**Before:**
```markdown
**description:** Creates detailed workflows and project plans based on commands from King. 
Breaks down high-level requirements into actionable tasks and timelines.
```

**After:**
```markdown
**description:** Creates detailed request documents and project plans based on commands from King. 
Uses PRD template to document requirements and creates TDD-based implementation strategies.
```
→ PRD 템플릿과 TDD 전략이 핵심 역할임을 명시

#### B. Responsibilities → Core Responsibilities (4항목으로 간소화)
**Before**: 6개 일반적 책임 (Workflow Creation, Task Breakdown, Timeline Planning 등)

**After**: 4개 핵심 책임
1. **Request Document Creation**: PRD 기반 요청 문서 작성
2. **Requirements Analysis**: 구체적 Input→Output 명세로 분해
3. **TDD Strategy Planning**: TDD 방법론에 따른 계획 작성
4. **Quality Standard Reference**: 프로젝트 기준 준수 보장

#### C. Workflow Process → Planning Workflow (3 Phase 구조)

**Before**: 8단계 단순 나열
```
1. Consult Memory
2. Receive Command
3. Analyze Requirements
4. Create Workflow
5. Assign Tasks
6. Set Milestones
7. Monitor Progress
8. Adjust Plan
```

**After**: 3 Phase로 구조화
```
Phase 1: Research & Context Gathering
├─ 1. Receive Command (건물주로부터 기능 요청)
├─ 2. Consult Memory (과거 데이터 확인)
│    - Similar implementations
│    - Successful patterns
│    - Failed approaches to avoid
│    - Lessons learned
└─ 3. Reference Standards ⭐ (NEW)
     - doc/tdd.md (TDD 방법론)
     - doc/checklist.md (기술적 제약사항)
     - .cursorrules (코드 컨벤션)

Phase 2: Document Creation
├─ 4. Create Request Document ⭐ (NEW)
│    - Copy prd.md template
│    - Create request/[feature-name].md
│    - Fill required sections:
│      - Section 1: Feature Overview
│      - Section 2: Input → Output (MOST IMPORTANT)
│      - Section 4: Implementation Checklist
│      - Section 5: Success Criteria
├─ 5. Validate Document Completeness
│    - Concrete Before/After examples
│    - Clear testable items
│    - Measurable success criteria
│    - Edge cases identified
└─ 6. Submit to King (Quality Gate 검토용)

Phase 3: Implementation Planning (After User Approval)
├─ 7. Create TDD Plan
│    - Define test scenarios from Input→Output
│    - Plan Red-Green-Refactor iterations
│    - Break into smallest testable units
│    - Reference doc/tdd.md
├─ 8. Create Work Breakdown
│    - Implementation steps
│    - Dependencies
│    - Milestones
│    - Technical constraints from doc/checklist.md
└─ 9. Deliver to Worker
```

#### D. 새로운 섹션 추가

**1) Required References** ⭐ (NEW)
```markdown
### Must Read Before Planning
- home/memoryHome.md: Historical patterns
- doc/tdd.md: TDD methodology (Red-Green-Refactor)
- doc/checklist.md: Technical constraints (CRLF, lint)
- .cursorrules: Code conventions (naming, formatting)

### Template to Use
- prd.md: Request document template
```

**2) Document Reference Impact** ⭐ (NEW)

사용자가 요청한 "문서 참조 vs 미참조 비교" 내용:

```markdown
1. doc/tdd.md 참조:
   - Without: 폭포수 방식 계획 작성 가능
   - With: Red→Green→Refactor 단계 명확히 정의

2. doc/checklist.md 참조:
   - Without: CRLF, linter 설정 등 중요 이슈 놓칠 수 있음
   - With: 설정 단계와 검증 체크포인트 포함

3. home/memoryHome.md 참조:
   - Without: 실패한 접근 방식 반복 가능
   - With: 과거 프로젝트의 성공 패턴 활용
```

#### E. 섹션 통합 및 제거

**제거된 섹션:**
- ❌ Role Definition (description과 중복)
- ❌ Recurring Events Specific Planning (프로젝트 특정)
- ❌ TDD Planning Responsibilities (Planning Workflow에 통합)
- ❌ Communication Protocol (Agent Coordination으로 통합)
- ❌ Integration Points (Agent Coordination으로 통합)

**통합된 섹션:**
- ✅ Communication Protocol + Integration Points → **Agent Coordination**
  - Receives From
  - Provides To

#### F. Success Metrics 업데이트

**Before**: 일반적인 지표 (정확성, 일정 준수 등)

**After**: 구체적이고 측정 가능한 지표
- Request document completeness > 90% on first submission
- Clear Input→Output examples in all requests
- TDD plans follow `doc/tdd.md` methodology
- Technical constraints from `doc/checklist.md` incorporated
- Zero rework due to missing requirements

---

### 2. planerHome.md 리팩토링

#### A. description 업데이트
**Before:**
```markdown
**description:** Storage for Planner's learning, plans, and workflows
```

**After:**
```markdown
**description:** Storage for Planner's learned patterns, test writing guidelines, 
and project-specific workflow analyses

**Note**: For standard workflow, refer to `people/planer.md`. 
This home stores learned knowledge and project-specific insights.
```
→ 역할이 명확해짐

#### B. 중복 제거

**제거된 섹션:**
1. ❌ **Workflow Execution Steps** (planer.md에 더 상세하게 있음)
   - Consult Memory → Analyze Requirements → Create Workflow → Return to King

2. ❌ **Workflow Templates** (너무 일반적)
   - Learning Workflow
   - Implementation Workflow
   - Review Workflow

3. ❌ **Integration with Memory** (planer.md Phase 1에 명시됨)

#### C. 구조 개선

**Before:**
```
## Workflow Execution Steps
## Stored Plans
  ### Recent Learning Plans
## Workflow Templates
## Application Workflow Analysis
## Integration with Memory
```

**After:**
```
## Learned Patterns
  ### Learning: Test Code Description Writing
    - Test Description Structure
    - Required Ingredients
    - Description Choice Rules
    - Test Structure

## Project-Specific Analysis
  ### Calendar App Workflow Analysis
    - Event Creation Workflow
    - Event Editing Workflow
    - Event Display Workflow
    - Notification Workflow
    - Data Flow Patterns
    - Error Handling Strategy
    - Optimization Patterns
```

→ "학습된 패턴"과 "프로젝트별 분석"으로 명확히 분리

---

### 3. request 폴더 구성

#### A. 폴더 확인
- `src/.cursor/agents/request/` 폴더 이미 존재
- 비어있는 상태

#### B. README.md 생성 ⭐
```markdown
# Request Documents Folder

**Purpose**: PRD-based feature request documents storage

## File Naming Convention
[feature-name].md

Examples:
- recurring-events.md
- dark-mode-toggle.md

## Document Lifecycle
1. ⏳ Pending Review: Planner creates → King reviews
2. 👤 Awaiting User Confirmation: King Quality Gate → User reviews
3. ✅ Approved: User approves → Worker implements
4. 🔄 Revise: User requests changes → Planner updates
5. ❌ Rejected: User rejects → Archive/delete

## Template
Use `src/.cursor/agents/prd.md`

Key sections:
1. Feature Overview
2. Input → Output (MOST IMPORTANT)
3. Technical Requirements (optional)
4. Implementation Checklist
5. Success Criteria
6. Questions/Concerns (optional)
7. User Confirmation
```

---

## 📋 최종 구조

### planer.md
```
# Planner - 계획자

**description:** Creates request documents and TDD-based strategies

## Core Responsibilities (4항목)
- Request Document Creation
- Requirements Analysis
- TDD Strategy Planning
- Quality Standard Reference

## Planning Workflow (3 Phase)

### Phase 1: Research & Context Gathering
1. Receive Command
2. Consult Memory
3. Reference Standards ⭐
   - doc/tdd.md
   - doc/checklist.md
   - .cursorrules

### Phase 2: Document Creation
4. Create Request Document ⭐
   - Use prd.md template
   - Create request/[feature-name].md
   - Fill required sections
5. Validate Document Completeness
6. Submit to King

### Phase 3: Implementation Planning (After User Approval)
7. Create TDD Plan
8. Create Work Breakdown
9. Deliver to Worker

## Key Deliverables
- Request Document (request/[feature-name].md)
- TDD Plan (Red-Green-Refactor cycles)
- Work Breakdown (tasks + dependencies)

## Required References ⭐
- home/memoryHome.md
- doc/tdd.md
- doc/checklist.md
- .cursorrules
- prd.md (template)

## Document Reference Impact ⭐
(문서 참조 vs 미참조 비교)

## Agent Coordination
- Receives From: King, Memory
- Provides To: King, Worker, Manager

## Success Metrics
(구체적이고 측정 가능한 5개 지표)
```

### planerHome.md
```
# Planner Home - 계획자집

**description:** Learned patterns and project-specific analyses

**Note**: Standard workflow → people/planer.md

## Learned Patterns
### Test Code Description Writing (2025-10-27)
- Test Description Structure
- Required Ingredients
- Description Choice Rules
- Test Structure (Arrange-Act-Assert)

## Project-Specific Analysis
### Calendar App Workflow Analysis (2025-10-27)
- Event Creation Workflow
- Event Editing Workflow
- Event Display Workflow
- Notification Workflow
- Data Flow Patterns
- Error Handling Strategy
- Optimization Patterns
```

### request/
```
request/
├── README.md (생성됨 ⭐)
└── (미래: [feature-name].md 파일들이 여기 생성됨)
```

---

## 🎯 핵심 개선 사항

### 1. 문서 참조 프로세스 추가 ✅
- **Phase 1, Step 3**: doc/tdd.md, doc/checklist.md, .cursorrules 참조 명시
- **Document Reference Impact 섹션**: 참조 vs 미참조 비교 설명

### 2. PRD 템플릿 프로세스 추가 ✅
- **Phase 2, Step 4**: prd.md 템플릿 사용 프로세스 상세 정의
- request/[feature-name].md 생성 방법 명시
- 필수 섹션 체크리스트 제공

### 3. 중복 제거 ✅
- planer.md: Role Definition 제거
- planerHome.md: Workflow Execution Steps, Workflow Templates, Integration with Memory 제거
- 중복 제거로 32줄 감소

### 4. 구조 명확화 ✅
- planer.md: 3 Phase 워크플로우로 재구성
- planerHome.md: "학습된 패턴" vs "프로젝트별 분석" 명확히 분리
- request/: README.md로 폴더 목적 명시

### 5. 프로젝트 특정 내용 제거 ✅
- "Recurring Events Specific Planning" 제거
- 범용성 향상

---

## 💡 사용자 요청 사항 대응

### ✅ 1. doc/checklist와 tdd 문서 참조 확인
→ **Phase 1, Step 3: Reference Standards**에 명시
- doc/tdd.md 읽기
- doc/checklist.md 검토
- .cursorrules 확인

### ✅ 2. 문서 참조 vs 미참조 결과 비교
→ **Document Reference Impact** 섹션에 명시

| 문서 | 미참조 시 | 참조 시 |
|------|-----------|---------|
| doc/tdd.md | 폭포수 방식 계획 | Red-Green-Refactor 명확 |
| doc/checklist.md | CRLF 등 이슈 놓침 | 검증 체크포인트 포함 |
| memoryHome.md | 실패 접근 반복 | 성공 패턴 활용 |

### ✅ 3. prd.md로 request 문서 생성
→ **Phase 2, Step 4: Create Request Document**에 상세 정의
- prd.md 템플릿 복사
- request/[feature-name].md 생성
- 필수 섹션 채우기
- 검증 후 King에게 제출

### ✅ 4. 계획자집 중복 제거
→ 32줄 감소
- Workflow Execution Steps 제거
- Workflow Templates 제거
- Integration with Memory 제거

---

## 📈 효과

1. **명확성**: 계획자가 무엇을 해야 하는지 단계별로 명확
2. **품질**: 문서 참조로 TDD 방법론과 기술 제약사항 준수
3. **효율성**: PRD 템플릿으로 일관된 요청 문서 작성
4. **추적성**: request/ 폴더에 모든 기능 요청 문서 보관
5. **학습**: planerHome.md에 학습된 패턴 누적

---

## 결론

계획자가 이제:
1. ✅ Memory, doc/tdd.md, doc/checklist.md, .cursorrules를 **명시적으로 참조**
2. ✅ **prd.md 템플릿**을 사용하여 **request/[feature-name].md** 생성
3. ✅ 문서 참조 시 **TDD 사이클, 기술 제약사항, 과거 패턴**을 반영
4. ✅ 중복 없이 **명확한 3 Phase 워크플로우** 실행
5. ✅ **측정 가능한 성공 지표**로 품질 보장

**계획자가 더 체계적이고 품질 높은 계획을 수립할 수 있게 되었습니다!** 🎯

