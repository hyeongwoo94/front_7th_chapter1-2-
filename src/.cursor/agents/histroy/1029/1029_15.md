질문 (원본):
2025-10-29

질문: 관리자를 리팩토링하자.
지금 노동자,계획자를 모두 리팩토링 했으니 관리자도 리팩토링이 필요하다.
관리자는 노동자와 계획자가 일처리를 잘했는지 확인을하는 에이전트니깐 관리자는 doc안의 문서들을 참조해야하고 그 이전의 성공했던것과 실패했던 것을 참조하여 검증해야하니깐 이 내용에 대해 잘 명세되어 있는지 확인하고 리팩토링해줘.

답변:

# 관리자(Manager) 리팩토링 완료 ✅

## 📊 리팩토링 개요

관리자가 doc/ 문서와 과거 사례를 기반으로 노동자와 계획자의 작업을 체계적으로 검토할 수 있도록 완전히 재구성했습니다.

---

## 🔍 발견된 문제점

### 1. doc 문서 참조 없음 ❌
- `doc/tdd.md` 참조 없음
- `doc/test-guidelines.md` 참조 없음
- `doc/checklist.md` 참조 없음
- 어떤 기준으로 검토하는지 불명확

### 2. 검토 기준이 추상적 ❌
```markdown
Before:
- Code Quality: Readability, maintainability, performance
- Test Coverage: Completeness and effectiveness
- Standards Compliance: Adherence to coding standards
```
→ **구체적으로 어떤 문서를 기준으로 검토하는지 불명확**

### 3. 노동자/계획자 검토 분리 안됨 ❌
- 단일 Review Process에 모두 섞여 있음
- 계획자 작업(request 문서)과 노동자 작업(코드/테스트)을 구분하지 않음

### 4. 과거 사례 참조가 일반적 ❌
```markdown
Before:
"Consult Memory: Check Memory for historical quality patterns..."
```
→ **구체적으로 무엇을 참조하는지 불명확**

### 5. 프로젝트 특정 내용 ❌
- "Recurring Events Specific Review" 섹션 존재
- 범용 관리자 역할과 무관

---

## 🔧 적용한 리팩토링

### 1. feedback.md (관리자 명세)

#### A. Description 업데이트

**Before:**
```markdown
**description:** Reviews work completed by Worker and Planner, 
ensuring all deliverables meet required standards.
```

**After:**
```markdown
**description:** Reviews work completed by Worker and Planner 
using project standards (doc/) and historical patterns (Memory). 
Ensures all deliverables meet quality requirements and provides 
actionable feedback for improvement.
```

→ **doc/ 문서와 Memory 참조를 명시**

#### B. Responsibilities → Core Responsibilities (5항목으로 간소화)

**Before:** 7개 일반적 책임

**After:**
```markdown
## Core Responsibilities
- Planner Work Review: Reviews request documents
- Worker Work Review: Reviews code, tests, deliverables
- Standards Validation: Ensures adherence to doc/ folder
- Historical Analysis: References past successes/failures from Memory
- Actionable Feedback: Provides implementable improvements
```

→ **계획자/노동자 검토를 명확히 분리**

#### C. Review Process → Review Workflows (2가지 타입으로 분리) ⭐

**Before:** 단일 9단계 프로세스
```
1. Consult Memory
2. Receive Deliverables
3. Initial Assessment
4. Detailed Review
5. Quality Analysis
6. Issue Identification
7. Feedback Generation
8. Checklist Creation
9. Report Submission
```

**After:** 3단계 구조로 재구성
```
### Preparation Phase (All Reviews)
1. Consult Memory
   - Past Successes
   - Past Failures
   - Quality Patterns
   - Effective Feedback
2. Reference Standards

### Type 1: Planner Work Review (Request Documents)
- When: After Planner creates request document
- Review Standards:
  * prd.md - Request document structure
  * doc/tdd.md - TDD plan validation
  * .cursorrules - Naming/formatting

- Review Checklist:
  A. Completeness Check
     - Section 1 (Feature Overview)
     - Section 2 (Input → Output) ⭐ MOST IMPORTANT
     - Section 5 (Success Criteria)
  
  B. Quality Check (using Memory)
     - Real data examples (not abstract)
     - Specific testable criteria
     - Edge cases identified
  
  C. TDD Alignment Check (doc/tdd.md)
     - Red-Green-Refactor phases
     - Features broken into testable units

### Type 2: Worker Work Review (Code & Tests)
- When: After Worker completes implementation
- Review Standards:
  * doc/tdd.md - Red-Green-Refactor cycle
  * doc/test-guidelines.md - Test structure, naming
  * doc/checklist.md - Pre-commit validation
  * .cursorrules - Code conventions

- Review Checklist:
  A. Code Quality (.cursorrules)
     - Function naming: camelCase + Korean translation
     - CSS classes: snake_case
     - TypeScript: No any type
     - Import order
  
  B. Test Quality (doc/test-guidelines.md)
     - Unit tests: .spec.ts in unit/
     - Component tests: .spec.tsx in components/
     - Korean descriptions
     - describe('Name >', () => {})
  
  C. TDD Adherence (doc/tdd.md)
     - Tests before implementation (Red)
     - Minimal code (Green)
     - Refactoring with tests passing (Refactor)
  
  D. Pre-Commit Validation (doc/checklist.md)
     - git diff --check (CRLF)
     - npm run lint:tsc
     - npm run lint:eslint
     - npm test -- --run
  
  E. Historical Analysis (memoryHome.md)
     - Past success patterns applied
     - Past mistakes avoided
     - Lessons learned incorporated

### Final Phase: Report to King
6. Generate Report
   - Issues found (with locations, examples)
   - Standards violations (with doc references)
   - Historical context (past cases)
   - Actionable recommendations
7. Submit to King
```

→ **계획자/노동자 검토를 완전히 분리하고 각각에 대해 참조할 doc 문서 명시**

#### D. 새로운 섹션 추가: Required Reference Documents ⭐

**Before:** 없음

**After:**
```markdown
## Required Reference Documents

### For All Reviews
- home/memoryHome.md: Past successes, failures, quality patterns

### For Planner Work Review
- prd.md: Request document template
- doc/tdd.md: TDD methodology
- .cursorrules: Code conventions

### For Worker Work Review
- doc/tdd.md: Red-Green-Refactor cycle
- doc/test-guidelines.md: Test structure, naming
- doc/checklist.md: Pre-commit validation
- .cursorrules: Code conventions
```

→ **검토 시 참조해야 할 모든 문서를 명시적으로 나열**

#### E. 중복/프로젝트 특정 섹션 제거

**제거된 섹션:**
- ❌ Role Definition (description과 중복)
- ❌ TDD Review Criteria (Review Workflows에 통합)
- ❌ Recurring Events Specific Review (프로젝트 특정)
- ❌ Review Criteria (추상적, Review Workflows로 대체)
- ❌ Communication Protocol (Agent Coordination으로 통합)
- ❌ Integration Points (Agent Coordination으로 통합)

#### F. Agent Coordination 섹션 신설

**Before:** Integration Points + Communication Protocol (분산됨)

**After:**
```markdown
## Agent Coordination

### Receives From
- King: Review requests
- Planner: Request documents from request/
- Worker: Code, tests, integration deliverables
- Memory: Past patterns from home/memoryHome.md

### Provides To
- King: Review reports with approval/revision
- Planner: Feedback on request documents
- Worker: Feedback on code/tests/standards
- Memory: Review outcomes for future reference
```

→ **명확한 입출력 관계**

#### G. Success Metrics 업데이트

**Before:** 추상적인 6개 지표
```
- Issue detection accuracy
- Quality improvement effectiveness
- Review thoroughness
```

**After:** 구체적이고 측정 가능한 6개 지표
```
- Reviews reference all applicable doc/ standards
- Historical patterns from Memory consulted in every review
- Issues identified with specific doc references and examples
- Feedback is specific and actionable (not abstract)
- Standards compliance rate > 95%
- Zero repeat of past documented failures
```

---

### 2. feedbackHome.md (관리자집)

#### A. Description 업데이트

**Before:**
```markdown
**description:** Storage for Manager's reviews, feedback, 
and quality insights
```

**After:**
```markdown
**description:** Storage for Manager's review patterns, 
quality insights, and lessons learned from past reviews

**Note**: For standard review workflow, refer to people/feedback.md. 
This home stores review history and quality patterns.
```

→ **역할이 명확해짐**

#### B. 중복 제거

**제거된 섹션:**
- ❌ Review Workflow Execution (feedback.md에 더 상세하게 있음)
- ❌ Integration with Memory (일반적 설명, feedback.md로 이동)

#### C. Quality Patterns Library 신설 ⭐

**Before:** 없음

**After:**
```markdown
## Quality Patterns Library

### Common Issues Found in Past Reviews
Example Pattern:
  Issue: Missing concrete Input→Output examples
  Frequency: 40% of Planner reviews
  Impact: User confusion, delays
  Solution: Request specific Before/After data
  Reference: prd.md Section 2

### Effective Review Approaches
Example Approach:
  Approach: Always check doc/test-guidelines.md for tests
  Effectiveness: Caught 85% of violations
  Outcome: Faster reviews, clearer feedback

### Past Success Cases
(To be populated)

### Past Failure Cases
(To be populated with lessons learned)
```

→ **과거 사례를 구조적으로 저장하는 템플릿 제공**

#### D. Document Reference Checklist 신설 ⭐

**Before:** 없음

**After:**
```markdown
## Document Reference Checklist

### For Every Review
- [ ] Consulted home/memoryHome.md for past patterns
- [ ] Referenced applicable doc/ standards
- [ ] Checked .cursorrules for conventions

### For Planner Reviews
- [ ] Validated against prd.md template
- [ ] Checked TDD alignment with doc/tdd.md

### For Worker Reviews
- [ ] Validated tests against doc/test-guidelines.md
- [ ] Checked pre-commit with doc/checklist.md
- [ ] Verified TDD cycle with doc/tdd.md
```

→ **검토 시 체크해야 할 문서들을 명시**

---

## 📋 최종 구조

### feedback.md (관리자 명세)
```
# Manager - 관리자

**description:** Reviews using project standards (doc/) 
              and historical patterns (Memory)

## Core Responsibilities (5항목)
- Planner Work Review
- Worker Work Review
- Standards Validation
- Historical Analysis
- Actionable Feedback

## Review Workflows

### Preparation Phase (All Reviews)
1. Consult Memory (4가지 항목)
2. Reference Standards

### Type 1: Planner Work Review
- Review Standards (3가지)
- Review Checklist (3개 섹션)
- Deliverable

### Type 2: Worker Work Review
- Review Standards (4가지)
- Review Checklist (5개 섹션: A-E)
- Deliverable

### Final Phase: Report to King

## Required Reference Documents ⭐
- For All Reviews
- For Planner Work Review
- For Worker Work Review

## Key Deliverables (5항목)
## Agent Coordination
- Receives From
- Provides To
## Success Metrics (6항목)
```

### feedbackHome.md (관리자집)
```
# Manager Home - 관리자집

**description:** Review patterns, quality insights, lessons learned

**Note**: Standard workflow → people/feedback.md

## Quality Patterns Library ⭐
- Common Issues Found
- Effective Review Approaches
- Past Success Cases
- Past Failure Cases

## Document Reference Checklist ⭐
- For Every Review
- For Planner Reviews
- For Worker Reviews
```

---

## 🎯 문서 참조 체계

```
Manager (관리자)
├─ Preparation
│  └─ home/memoryHome.md (과거 성공/실패/패턴)
│
├─ Planner Work Review
│  ├─ prd.md (요청 문서 구조)
│  ├─ doc/tdd.md (TDD 계획 검증)
│  └─ .cursorrules (네이밍/포맷팅)
│
└─ Worker Work Review
   ├─ doc/tdd.md (Red-Green-Refactor)
   ├─ doc/test-guidelines.md (테스트 구조)
   ├─ doc/checklist.md (커밋 전 검증)
   └─ .cursorrules (코드 컨벤션)
```

---

## 💡 검토 시나리오

### 시나리오 1: 계획자 작업 검토

```
1. King: "계획자가 작성한 request/dark-mode.md를 검토해"
   ↓
2. Manager: 
   - home/memoryHome.md 확인
     * 과거: "Input→Output 추상적" 문제 빈번
     * 교훈: 구체적 데이터 예시 요구
   ↓
3. Manager:
   - prd.md 템플릿과 비교
     * Section 1 ✓
     * Section 2 ❌ (Before/After 예시 없음)
     * Section 5 ✓
   ↓
4. Manager:
   - doc/tdd.md와 TDD 계획 비교
     * Red-Green-Refactor 언급 안 됨 ❌
   ↓
5. Manager → King:
   "검토 완료. 2가지 개선 필요:
   1. Section 2에 구체적 Before/After 데이터 추가 필요 (prd.md 참조)
   2. TDD 계획 추가 (doc/tdd.md의 Red-Green-Refactor)"
```

### 시나리오 2: 노동자 작업 검토

```
1. King: "노동자가 구현한 generateRecurringEvents를 검토해"
   ↓
2. Manager:
   - home/memoryHome.md 확인
     * 과거 성공: 반복 횟수 기반 계산
     * 과거 실패: CRLF 문제 빈번
   ↓
3. Manager:
   A. Code Quality (.cursorrules)
      - 함수명: generateRecurringEvents ✓ (camelCase + 직관적)
      - TypeScript: 모든 타입 명시 ✓
      
   B. Test Quality (doc/test-guidelines.md)
      - 파일: __tests__/unit/recurringEvents.spec.ts ✓
      - 설명: 한글 ✓
      - 패턴: describe('generateRecurringEvents >', ...) ✓
      
   C. TDD Adherence (doc/tdd.md)
      - 테스트 먼저 작성 ✓
      - 최소 코드 구현 ✓
      
   D. Pre-Commit (doc/checklist.md)
      - CRLF 체크 ❌ (과거 실패 패턴!)
      - Lint 통과 ✓
      - 테스트 통과 ✓
   ↓
4. Manager → King:
   "검토 완료. 1가지 치명적 문제:
   - CRLF 줄바꿈 발견 (doc/checklist.md 1번 항목 위반)
   - 과거에도 동일 문제 발생 (memoryHome.md 참조)
   - 해결: git diff --check 실행 후 LF로 변경 필요"
```

---

## 📊 개선 효과

### 1. 명확한 검토 기준
**Before:**
- "Code Quality를 검토한다" (추상적)

**After:**
- "`.cursorrules`를 기준으로 camelCase 네이밍, snake_case 클래스, TypeScript 타입 검토"
- "구체적으로 어떤 문서의 어떤 항목을 확인하는지 명시"

### 2. 계획자/노동자 검토 분리
**Before:**
- 단일 프로세스에 모두 섞여 있음
- 무엇을 검토하는지 불명확

**After:**
- Type 1: Planner Work Review (request 문서)
- Type 2: Worker Work Review (코드/테스트)
- 각각 다른 기준과 체크리스트 적용

### 3. doc 문서 기반 검증
**Before:**
- doc 문서 참조 없음
- 주관적 검토 가능성

**After:**
- 모든 검토가 doc/ 문서 기준
- 객관적이고 일관된 검토
- 피드백에 문서 참조 포함

### 4. 과거 사례 활용 체계화
**Before:**
- "Memory를 확인한다" (일반적)

**After:**
- 4가지 항목 명시 (성공/실패/패턴/피드백)
- feedbackHome.md에 Quality Patterns Library
- 구조적으로 과거 사례 저장 및 활용

### 5. 실행 가능한 피드백
**Before:**
- "Code quality needs improvement" (추상적)

**After:**
- "Section 2에 구체적 Before/After 예시 추가 (prd.md Section 2 참조)"
- "CRLF → LF 변경 필요 (doc/checklist.md 1번 위반)"

---

## 결론

**관리자가 이제:**

1. ✅ **doc/ 문서 기반 검증**
   - tdd.md (TDD 사이클)
   - test-guidelines.md (테스트 구조)
   - checklist.md (커밋 전 검증)

2. ✅ **과거 사례 참조**
   - memoryHome.md에서 성공/실패 패턴
   - feedbackHome.md에 Quality Patterns Library
   - 반복 실수 방지

3. ✅ **명확한 검토 분리**
   - 계획자 작업: request 문서 검토
   - 노동자 작업: 코드/테스트 검토
   - 각각 다른 기준 적용

4. ✅ **구체적이고 실행 가능한 피드백**
   - 문제 위치 명시
   - 위반한 doc 문서 참조
   - 과거 유사 사례 언급
   - 구체적 해결 방법 제시

**관리자가 훨씬 더 체계적이고 효과적으로 품질을 검증할 수 있게 되었습니다!** 🎯

