# 질문 (원본)

2025-10-29

**질문**: 
아니 새로운 event-edit를 생성하라는게 아니다.
request/prd.md 안을 수정하라는 말이다.
작업을하다가 같은 에러를 2번 반복했는데도 계속 같은 오류가 난다면 현재 작업을 일시정지하고 오류가 나는 이유를 찾기위해 리뷰를 하고 리뷰를 통해 오류를 찾았다면 해당 reaquest 파일을 수정하고 일시정지한 작업을 다시 시작하겍끔 만들라는거야. 프로세스를 구축하는 거지 즉. request/prd.md의 명세서를 수정해야하는거야.

---

# 답변

## 완료된 작업 ✅

`src/.cursor/agents/request/prd.md` 템플릿에 **오류 복구 프로세스**를 추가했습니다.

### 주요 변경사항:

#### 1. **Section 7: Error Recovery Process ⚠️** 추가
<!-- 섹션 7: 오류 복구 프로세스 -->

5단계 프로토콜:

**Step 1: Immediate Pause ⏸️**
- 같은 오류가 2번 발생하면 즉시 중단
- 세 번째 시도하지 말 것

**Step 2: Conduct Review 🔍**
- `review/` 폴더에 리뷰 문서 생성
- 오류 패턴, 근본 원인, 상세 해결방안 작성

**Step 3: Update This PRD 📝**
- Section 3에 **Prerequisites** 추가
- Section 4에 **Error Prevention** 추가
- Section 8에 **Known Issues & Solutions** 추가

**Step 4: Restart Implementation 🔄**
- 업데이트된 PRD를 읽고 재시작
- 검증 체크리스트 완료 후 진행

**Step 5: Post-Implementation Update 📊**
- Implementation History 추가
- 핵심 교훈 기록

#### 2. **Worker 가이드에 Critical 프로토콜 추가**

```
🔴 STOP immediately
📝 Follow Section 7: Error Recovery Process
1. Pause implementation
2. Create review document
3. Update this PRD
4. Restart with updated PRD
```

#### 3. **Key Principles에 5번째 원칙 추가**

**"Error Recovery is Built-In"**: 같은 오류 2번 = 일시중지 & 리뷰

#### 4. **버전 업데이트**

- v3.0 → **v4.0** (2025-10-29 - Added Error Recovery Process)

---

## 프로세스 흐름 예시

```
Error 1 → Fix → Error 2 (SAME) 
→ 🛑 PAUSE 
→ Review (review/파일.md 생성)
→ Update PRD (Prerequisites, Error Prevention, Known Issues 추가)
→ Restart (업데이트된 PRD로 재시작)
→ ✅ Success
```

---

## 실제 사용 예시

**Scenario**: Integration test가 2번 실패

1️⃣ **First Failure**: "Unable to find element" → await 추가 → 여전히 실패

2️⃣ **Second Failure (TRIGGER)**: 같은 오류 → 🛑 **PAUSE**

3️⃣ **Review**: `review/2025-10-29_recurring-test-failure.md` 생성
   - Root Cause: Mock 데이터 미로드, 비동기 타이밍 문제
   - Solution: 테스트 헬퍼 필요 (`asyncHelpers.ts`, `mockHelpers.ts`)

4️⃣ **Update PRD**:
   ```markdown
   ### Prerequisites (New)
   - [ ] Create asyncHelpers.ts BEFORE tests
   - [ ] Create mockHelpers.ts BEFORE tests
   
   ### Error Prevention (New)
   - Always use waitForEventInList()
   - Never use immediate getByText() after state change
   
   ### Known Issues (New)
   - Issue: Element not found
   - Solution: Use proper wait helpers
   ```

5️⃣ **Restart**:
   - ✅ 헬퍼 먼저 생성
   - ✅ 모든 테스트에서 헬퍼 사용
   - ✅ 테스트 통과 성공

6️⃣ **Document**:
   ```markdown
   ## Implementation History
   
   ### Attempt 1: 2025-10-29
   - **Status**: ❌ Failed
   - **Error**: Async timing issues
   - **Review**: review/2025-10-29_recurring-test-failure.md
   
   ### Attempt 2: 2025-10-29
   - **Status**: ✅ Success
   - **Changes**: Added test helper utilities
   - **Key Learnings**: Always create utilities before tests
   ```

---

## 프로세스 자동화 효과

### ✅ 장점:

1. **시간 낭비 방지**: 잘못된 접근으로 계속 시도하지 않음
2. **지식 축적**: PRD가 점점 더 완벽해짐
3. **재발 방지**: 같은 오류를 다시 겪지 않음
4. **성공률 증가**: 두 번째 시도 성공 가능성 대폭 증가

### 📊 Success Metrics:

**이 프로세스가 작동하는 경우:**
- 두 번째 시도에서 성공
- 같은 오류가 세 번째로 발생하지 않음
- PRD가 시간이 지남에 따라 더 포괄적이 됨

**개선이 필요한 경우:**
- PRD 업데이트 후에도 여전히 실패
- 리뷰에서 근본 원인을 찾지 못함
→ King에게 아키텍처 리뷰 요청

---

## 파일 변경사항:

**수정된 파일:**
- `src/.cursor/agents/request/prd.md`
  - Section 7 추가 (Error Recovery Process)
  - Worker 가이드 업데이트
  - Key Principles 추가
  - 버전 4.0으로 업데이트

**삭제된 파일:**
- `src/.cursor/agents/request/recurring-event-edit-options-v2.md` (잘못 생성된 파일)

---

이제 모든 Worker들은 같은 오류가 2번 발생하면 자동으로:
1. 🛑 작업 중단
2. 📝 리뷰 생성
3. 📄 PRD 업데이트
4. 🔄 재시작

이 프로세스를 따르게 됩니다! ✅

