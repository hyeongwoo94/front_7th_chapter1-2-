질문 (원본):
2025-10-29

질문: 캘린더에 매일, 매주, 매월, 매년 표시되는 아이콘을 각각 다른걸로 해줘

답변:

## 반복 타입별 아이콘 차별화 완료 ✅

### 작업 개요
- **작업 유형**: UI 개선 - 반복 타입별 아이콘 차별화
- **구현 날짜**: 2025-10-29
- **Worker 역할**: Tools (노동자)

### 사용자 요청

**현재 상황:**
- 모든 반복 일정에 동일한 `Repeat` 아이콘 표시

**요구사항:**
- 매일(daily), 매주(weekly), 매월(monthly), 매년(yearly) 각각 다른 아이콘 사용
- 사용자가 반복 타입을 한눈에 구분할 수 있도록

### 아이콘 매핑

| 반복 타입 | 아이콘 컴포넌트 | 설명 |
|---------|---------------|-----|
| `daily` | `Today` | 오늘/매일을 나타내는 캘린더 아이콘 |
| `weekly` | `CalendarViewWeek` | 주간 뷰를 나타내는 캘린더 아이콘 |
| `monthly` | `CalendarMonth` | 월간 뷰를 나타내는 캘린더 아이콘 |
| `yearly` | `Event` | 연간 이벤트를 나타내는 아이콘 |
| `none` | (표시 안 됨) | 일반 일정은 아이콘 없음 |
| default | `Repeat` | 기타 타입 (fallback) |

### 구현 내용

#### 1. `src/App.tsx` 수정

**아이콘 import 추가 (Line 8-11):**
```typescript
import Today from '@mui/icons-material/Today';
import CalendarViewWeek from '@mui/icons-material/CalendarViewWeek';
import CalendarMonth from '@mui/icons-material/CalendarMonth';
import EventIcon from '@mui/icons-material/Event';
```

**⚠️ 중요 노트:**
- `Event`는 TypeScript DOM `Event` 타입과 충돌하므로 `EventIcon`으로 import
- 초기에는 `import { Event as EventIcon } from '@mui/icons-material'`로 시도했으나 Windows에서 파일 핸들 제한 문제 발생 (EMFILE: too many open files)
- 최종적으로 `import EventIcon from '@mui/icons-material/Event'`로 해결하여 특정 아이콘만 로드

**헬퍼 함수 생성 (Line 82-99):**
```typescript
/**
 * Get appropriate icon component based on repeat type
 * 반복 타입에 따라 적절한 아이콘 컴포넌트 반환
 */
const getRepeatIcon = (repeatType: RepeatType) => {
  switch (repeatType) {
    case 'daily':
      return Today;
    case 'weekly':
      return CalendarViewWeek;
    case 'monthly':
      return CalendarMonth;
    case 'yearly':
      return EventIcon;
    default:
      return Repeat;
  }
};
```

**renderWeekView 수정 (Line 358-361):**
```typescript
// Before
{event.repeat.type !== 'none' && (
  <Repeat fontSize="small" data-testid="RepeatIcon" />
)}

// After
{event.repeat.type !== 'none' && (() => {
  const RepeatIconComponent = getRepeatIcon(event.repeat.type);
  return <RepeatIconComponent fontSize="small" data-testid="RepeatIcon" />;
})()}
```

**renderMonthView 수정 (Line 449-452):**
```typescript
// Before
{event.repeat.type !== 'none' && (
  <Repeat fontSize="small" data-testid="RepeatIcon" />
)}

// After
{event.repeat.type !== 'none' && (() => {
  const RepeatIconComponent = getRepeatIcon(event.repeat.type);
  return <RepeatIconComponent fontSize="small" data-testid="RepeatIcon" />;
})()}
```

### 기술적 구현 세부사항

#### IIFE (Immediately Invoked Function Expression) 사용

**이유:**
- JSX 내에서 복잡한 로직을 간결하게 표현
- `getRepeatIcon()`의 반환값(컴포넌트 타입)을 즉시 사용

**구조:**
```typescript
{condition && (() => {
  const Component = getFunction();
  return <Component props />;
})()}
```

**장점:**
1. 변수 선언과 사용을 한 곳에서 처리
2. JSX 가독성 유지
3. 타입 안정성 보장

#### 타입 안정성

**getRepeatIcon 반환 타입:**
```typescript
// React component constructor type
typeof Today | typeof CalendarViewWeek | typeof CalendarMonth | typeof Event | typeof Repeat
```

**렌더링:**
```typescript
const RepeatIconComponent = getRepeatIcon(event.repeat.type);
// RepeatIconComponent는 React component constructor
<RepeatIconComponent fontSize="small" data-testid="RepeatIcon" />
// JSX에서 컴포넌트로 렌더링
```

### 검증 결과

#### TypeScript 검증 ✅
```bash
npm run lint:tsc
✓ No errors
```

#### 전체 테스트 ✅
```bash
npm test -- --run
✓ Test Files: 14 passed (14)
✓ Tests: 137 passed (137)
Duration: 24.69s
```

**테스트 영향 분석:**
- `data-testid="RepeatIcon"`은 유지됨
- 기존 테스트 코드 수정 불필요
- 아이콘 타입만 변경되어 테스트 동작에 영향 없음

### 사용자 경험 개선

#### Before (이전)
```
주간 회의 🔁  (매주)
일일 미팅 🔁  (매일)
월간 점검 🔁  (매월)
```
→ 모든 반복 일정이 동일한 아이콘으로 구분 불가

#### After (현재)
```
주간 회의 📅  (매주 - CalendarViewWeek)
일일 미팅 📆  (매일 - Today)
월간 점검 🗓️  (매월 - CalendarMonth)
```
→ 각 반복 타입을 아이콘으로 즉시 구분 가능

### 코드 품질

**재사용성:**
- `getRepeatIcon()` 헬퍼 함수로 중복 제거
- renderWeekView와 renderMonthView에서 동일한 로직 사용

**유지보수성:**
- 새로운 반복 타입 추가 시 `getRepeatIcon()` 함수만 수정
- 아이콘 변경 필요 시 한 곳에서 관리

**타입 안정성:**
- `RepeatType` 타입에 기반한 switch 문
- TypeScript가 누락된 case 감지 가능

### 향후 개선 가능 사항

#### 1. Tooltip 추가
```typescript
<Tooltip title={`${getRepeatLabel(event.repeat.type)} 일정`}>
  <RepeatIconComponent fontSize="small" data-testid="RepeatIcon" />
</Tooltip>
```

#### 2. 색상 차별화
```typescript
const getRepeatIconColor = (repeatType: RepeatType) => {
  switch (repeatType) {
    case 'daily': return 'primary';
    case 'weekly': return 'secondary';
    case 'monthly': return 'success';
    case 'yearly': return 'warning';
    default: return 'action';
  }
};
```

#### 3. 애니메이션 효과
```typescript
<RepeatIconComponent 
  fontSize="small" 
  sx={{ 
    animation: 'pulse 2s infinite',
    '@keyframes pulse': {
      '0%, 100%': { opacity: 1 },
      '50%': { opacity: 0.5 }
    }
  }}
/>
```

### 영향 범위

**변경된 동작:**
- 반복 일정 아이콘이 타입에 따라 다르게 표시됨

**유지된 동작:**
- 일반 일정은 아이콘 없음
- `data-testid="RepeatIcon"` 유지로 테스트 호환성 유지
- 아이콘 크기 (`fontSize="small"`) 동일
- 레이아웃 및 스타일 변경 없음

**영향받지 않는 부분:**
- 일정 CRUD 기능
- 일정 겹침 처리
- 검색 기능
- 알림 기능
- 반복 일정 수정 (단일/전체 선택)

### 문제 해결 과정

#### 이슈 1: Event 타입 충돌
**문제:**
- `import Event from '@mui/icons-material/Event'` 사용 시 TypeScript DOM `Event` 타입과 충돌
- 16개의 타입 에러 발생

**해결:**
- `import EventIcon from '@mui/icons-material/Event'`로 변경
- 타입 충돌 완전히 해결

#### 이슈 2: 파일 핸들 제한 (EMFILE)
**문제:**
- `import { Event as EventIcon } from '@mui/icons-material'` 사용 시
- Windows에서 "too many open files" 에러 발생
- 전체 아이콘 패키지 로드로 인한 파일 핸들 과다 사용

**해결:**
- `import EventIcon from '@mui/icons-material/Event'`로 특정 아이콘만 import
- 파일 핸들 문제 해결
- 테스트 정상 통과 (137/137)

### 관련 파일
- **History**: `src/.cursor/agents/histroy/1029/1029_25.md` (반복 일정 수정 기능)
- **History**: `src/.cursor/agents/histroy/1029/1029_26.md` (겹침 허용 규칙 변경)

